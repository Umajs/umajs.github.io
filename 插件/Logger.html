<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>日志（Logger） | UMajs 文档</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.20bf4c24.css" as="style"><link rel="preload" href="/assets/js/app.3d5ce5b5.js" as="script"><link rel="preload" href="/assets/js/2.9407ce33.js" as="script"><link rel="preload" href="/assets/js/4.e064d20e.js" as="script"><link rel="prefetch" href="/assets/js/10.17b92237.js"><link rel="prefetch" href="/assets/js/11.f810aac7.js"><link rel="prefetch" href="/assets/js/12.17a8f180.js"><link rel="prefetch" href="/assets/js/13.469b1a09.js"><link rel="prefetch" href="/assets/js/14.51fe412d.js"><link rel="prefetch" href="/assets/js/15.b196fd4f.js"><link rel="prefetch" href="/assets/js/16.ce03c2d1.js"><link rel="prefetch" href="/assets/js/17.22a8dd03.js"><link rel="prefetch" href="/assets/js/18.d961cf0c.js"><link rel="prefetch" href="/assets/js/19.58c4e66b.js"><link rel="prefetch" href="/assets/js/20.1ff1c08b.js"><link rel="prefetch" href="/assets/js/21.237df02f.js"><link rel="prefetch" href="/assets/js/22.819f0736.js"><link rel="prefetch" href="/assets/js/23.d26e43b5.js"><link rel="prefetch" href="/assets/js/24.b4d2d8e6.js"><link rel="prefetch" href="/assets/js/25.b3480f6e.js"><link rel="prefetch" href="/assets/js/26.0856344a.js"><link rel="prefetch" href="/assets/js/27.2e66242d.js"><link rel="prefetch" href="/assets/js/3.0b9c2b9b.js"><link rel="prefetch" href="/assets/js/5.0e8b81a8.js"><link rel="prefetch" href="/assets/js/6.88ea1aa9.js"><link rel="prefetch" href="/assets/js/7.11338dee.js"><link rel="prefetch" href="/assets/js/8.fdc9be60.js"><link rel="prefetch" href="/assets/js/9.8cf7ce43.js">
    <link rel="stylesheet" href="/assets/css/0.styles.20bf4c24.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">UMajs 文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/新手指南/框架介绍.html" class="nav-link">
  教程
</a></div> <a href="https://github.com/Umajs" target="_blank" rel="noopener noreferrer" class="repo-link">
    Git
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/新手指南/框架介绍.html" class="nav-link">
  教程
</a></div> <a href="https://github.com/Umajs" target="_blank" rel="noopener noreferrer" class="repo-link">
    Git
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>新手指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/新手指南/框架介绍.html" class="sidebar-link">框架介绍</a></li><li><a href="/新手指南/Uma.html" class="sidebar-link">Uma 与 Koa</a></li><li><a href="/新手指南/快速开始.html" class="sidebar-link">快速开始</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础功能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/基础功能/Uma 对象.html" class="sidebar-link">Uma 对象</a></li><li><a href="/基础功能/Router.html" class="sidebar-link">路由（Router）</a></li><li><a href="/基础功能/Controller.html" class="sidebar-link">控制器（Controller）</a></li><li><a href="/基础功能/Result.html" class="sidebar-link">统一返回（Result）</a></li><li><a href="/基础功能/Service.html" class="sidebar-link">服务（Service）</a></li><li><a href="/基础功能/Plugin.html" class="sidebar-link">插件（Plugin）</a></li><li><a href="/基础功能/IOC.html" class="sidebar-link">依赖注入（IOC）</a></li><li><a href="/基础功能/AOP.html" class="sidebar-link">面向切面（AOP）</a></li><li><a href="/基础功能/Config.html" class="sidebar-link">配置（Config）</a></li><li><a href="/基础功能/Middleware.html" class="sidebar-link">中间件（Middleware）</a></li><li><a href="/基础功能/Decorator.html" class="sidebar-link">修饰器（Decorator）</a></li><li><a href="/基础功能/断点调试.html" class="sidebar-link">断点调试</a></li><li><a href="/基础功能/错误处理.html" class="sidebar-link">错误处理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>插件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/插件/Status.html" class="sidebar-link">状态（Status）</a></li><li><a href="/插件/Static.html" class="sidebar-link">静态资源（Static）</a></li><li><a href="/插件/Views.html" class="sidebar-link">模板引擎（Views）</a></li><li><a href="/插件/i18n.html" class="sidebar-link">国际化（i18n）</a></li><li><a href="/插件/Logger.html" class="active sidebar-link">日志（Logger）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/插件/Logger.html#日志" class="sidebar-link">日志</a></li><li class="sidebar-sub-header"><a href="/插件/Logger.html#使用plugin-logger" class="sidebar-link">使用plugin-logger</a></li><li class="sidebar-sub-header"><a href="/插件/Logger.html#使用umalogger" class="sidebar-link">使用UmaLogger</a></li><li class="sidebar-sub-header"><a href="/插件/Logger.html#日志配置" class="sidebar-link">日志配置</a></li><li class="sidebar-sub-header"><a href="/插件/Logger.html#日志路径" class="sidebar-link">日志路径</a></li><li class="sidebar-sub-header"><a href="/插件/Logger.html#日志分类" class="sidebar-link">日志分类</a></li><li class="sidebar-sub-header"><a href="/插件/Logger.html#如何打印日志" class="sidebar-link">如何打印日志</a></li><li class="sidebar-sub-header"><a href="/插件/Logger.html#日志级别" class="sidebar-link">日志级别</a></li><li class="sidebar-sub-header"><a href="/插件/Logger.html#日志文件输出" class="sidebar-link">日志文件输出</a></li><li class="sidebar-sub-header"><a href="/插件/Logger.html#日志切割" class="sidebar-link">日志切割</a></li></ul></li><li><a href="/插件/Session.html" class="sidebar-link">Session</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="日志（logger）"><a href="#日志（logger）" class="header-anchor">#</a> 日志（Logger）</h1> <h2 id="日志"><a href="#日志" class="header-anchor">#</a> 日志</h2> <p>日志对于Web项目的运行状态、问题排查等都非常重要。框架的<code>@umajs/logger</code>模块提供日志支持。并且提供<code>@umajs/plugin-logger</code>模块，以插件的机制将logger实例绑定在ctx上，方便用户使用。</p> <p>主要特性：</p> <ul><li>日志分级</li> <li>统一错误日志，所有 logger 中使用 .error() 打印的 ERROR 级别日志都会打印到统一的错误日志文件中，便于追踪</li> <li>自定义日志</li> <li>自动切割日志</li></ul> <h2 id="使用plugin-logger"><a href="#使用plugin-logger" class="header-anchor">#</a> 使用<code>plugin-logger</code></h2> <ul><li>安装插件 <code>npm install -S @umajs/plugin-logger</code></li> <li>插件配置：</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//app/src/config/default/plugin.config.ts</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">ROOT</span> <span class="token punctuation">}</span> <span class="token operator">=</span> Uma<span class="token punctuation">.</span>options

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    logger<span class="token operator">:</span> <span class="token punctuation">{</span>
        enable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
            level<span class="token operator">:</span> <span class="token string">'DEBUG'</span><span class="token punctuation">,</span> <span class="token comment">//日志输出级别</span>
            file<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">ROOT</span><span class="token punctuation">,</span> <span class="token string">'../log/logger.log'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            allowDebugAtProd<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否允许打印debug日志</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>在Controller中使用logger</li></ul> <p><code>plugin-logger</code>插件将logger实例绑定在ctx上，因此可在项目中使用<code>this.ctx.logger</code>使用；</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app/src/controller/index.controller.ts</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token keyword">extends</span> <span class="token class-name">BaseController</span> <span class="token punctuation">{</span>
    @<span class="token function">Path</span><span class="token punctuation">(</span><span class="token string">'/index'</span><span class="token punctuation">)</span>
    @<span class="token function">RequestMethod</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">)</span>
    <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>testService<span class="token punctuation">.</span><span class="token function">return1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'warn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'这里是首页'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>在Service中使用logger 【 v0.0.5 版本后支持】</li></ul> <p><code>plugin-logger</code>绑定到ctx上的logger实例可通过<code>UmaLogger.instance()</code>获取</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// app/src/service/test.service.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BaseService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@umajs/core'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UmaLogger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@umajs/logger'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">test</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span> <span class="token punctuation">{</span>
    <span class="token function">return1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        UmaLogger<span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'service test'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// [INFO 51449] 2020-04-10 18:42:21,179 bogon [::1/GET /]: service test</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="使用umalogger"><a href="#使用umalogger" class="header-anchor">#</a> 使用UmaLogger</h2> <p><code>UmaLogger</code>可单独使用，具体提供如下几种使用方式：</p> <ol><li>通过 <code>new UmaLogger()</code> 独立创建日志实例</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app/src/controller/index.controller.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UmaLogger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@umajs/logger'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UmaLogger</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    level<span class="token operator">:</span> <span class="token string">'ALL'</span><span class="token punctuation">,</span>
    consoleLevel<span class="token operator">:</span> <span class="token string">'ALL'</span><span class="token punctuation">,</span>
    encoding<span class="token operator">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span>
    file<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../log/logger.log'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'info GET'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'warn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="2"><li>直接使用 <code>@umajs/logger</code> 模块默认导出的实例 【 v0.0.5 版本后支持】</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@umajs/logger'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    level<span class="token operator">:</span> <span class="token string">'ALL'</span><span class="token punctuation">,</span>
    consoleLevel<span class="token operator">:</span> <span class="token string">'ALL'</span><span class="token punctuation">,</span>
    encoding<span class="token operator">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span>
    file<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../log/logger.log'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'info GET'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'warn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="3"><li>通过单例模式使用 logger 【 v0.0.5 版本后支持】</li></ol> <p>只需传入一次参数，其他地方可直接使用 <code>UmaLogger.instance()</code> 获取实例化后日志对象</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app/src/controller/index.controller.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UmaLogger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@umajs/logger'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> logger <span class="token operator">=</span> UmaLogger<span class="token punctuation">.</span><span class="token function">instance</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    level<span class="token operator">:</span> <span class="token string">'ALL'</span><span class="token punctuation">,</span>
    consoleLevel<span class="token operator">:</span> <span class="token string">'ALL'</span><span class="token punctuation">,</span>
    encoding<span class="token operator">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span>
    file<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../log/logger.log'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'info GET'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'warn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="日志配置"><a href="#日志配置" class="header-anchor">#</a> 日志配置</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>exports<span class="token punctuation">.</span>logger <span class="token operator">=</span> <span class="token punctuation">{</span>
    level<span class="token operator">:</span> <span class="token string">'DEBUG'</span><span class="token punctuation">,</span> <span class="token comment">//日志输出级别</span>
    dir<span class="token operator">:</span> <span class="token string">'/path/to/your/custom/log'</span><span class="token punctuation">,</span> <span class="token comment">//日志输出目录</span>
    errorLogName<span class="token operator">:</span> <span class="token string">'errorlogger.log'</span><span class="token punctuation">,</span> <span class="token comment">//error级别日志文件名</span>
    infoLogName<span class="token operator">:</span> <span class="token string">'infologger.log'</span><span class="token punctuation">,</span> <span class="token comment">//info级别日志文件名</span>
    warnLogName<span class="token operator">:</span> <span class="token string">'warnlogger.log'</span><span class="token punctuation">,</span> <span class="token comment">//warn级别日志文件名</span>
    file<span class="token operator">:</span> <span class="token string">'/path/to/your/custom/log/logger.log'</span><span class="token punctuation">,</span> <span class="token comment">//日志文件写入路径(所有级别日志)</span>
    encoding<span class="token operator">:</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token comment">//日志编码格式</span>
    outputJSON<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//是否格式化输出携带pid等信息 false仅输出msg</span>
    consoleLevel<span class="token operator">:</span><span class="token string">'debug'</span><span class="token punctuation">,</span> <span class="token comment">//终端日志输出级别</span>
    allowDebugAtProd<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//是否允许打印debug日志</span>
    flushInterval<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">//文件流定时写入</span>
    maxBufferLength<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">//最大buffer 超出限制执行写入</span>
    <span class="token function-variable function">formatter</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">meta<span class="token operator">?</span><span class="token operator">:</span>TConsoleMeta</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>meta<span class="token punctuation">.</span>level<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>meta<span class="token punctuation">.</span>pid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>meta<span class="token punctuation">.</span>date<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>meta<span class="token punctuation">.</span>hostname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>meta<span class="token punctuation">.</span>paddingMessage<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>meta<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//日志格式化输出</span>
    splitTime<span class="token operator">:</span> <span class="token string">'00 00 * * * *'</span> <span class="token comment">//日志文件切割时间</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="日志路径"><a href="#日志路径" class="header-anchor">#</a> 日志路径</h2> <ol><li>默认日志文件路径：默认都放在<code>${APP_ROOT}/log/logger.log</code>路径下；</li> <li>自定义日志文件路径：
<code>config.file</code>会把所有日志统一写入<code>file</code>所指定的文件中；</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/logger.config.ts</span>
exports<span class="token punctuation">.</span>logger <span class="token operator">=</span> <span class="token punctuation">{</span>
    file<span class="token operator">:</span> <span class="token string">'/path/to/your/custom/log/logger.log'</span> <span class="token comment">//日志文件路径(所有级别日志统一写入)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>不同级别日志分开打印</li></ol> <p>日志按级别分开打印，需配置<code>config.dir config.errorLogName ...</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/logger.config.ts</span>
exports<span class="token punctuation">.</span>logger <span class="token operator">=</span> <span class="token punctuation">{</span>
    dir<span class="token operator">:</span> <span class="token string">'/path/to/your/custom/log'</span><span class="token punctuation">,</span> <span class="token comment">//日志目录</span>
    errorLogName<span class="token operator">:</span> <span class="token string">'errorlogger.log'</span><span class="token punctuation">,</span> <span class="token comment">//error级别日志文件名</span>
    infoLogName<span class="token operator">:</span> <span class="token string">'infologger.log'</span><span class="token punctuation">,</span> <span class="token comment">//info级别日志文件名</span>
    warnLogName<span class="token operator">:</span> <span class="token string">'warnlogger.log'</span><span class="token punctuation">,</span> <span class="token comment">//warn级别日志文件名</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>所有级别的日志会写入<code>/path/to/your/custom/log/logger.log</code>文件</p> <p><code>Info</code>级别的日志会写入<code>/path/to/your/custom/log/infoLogName.log</code>文件</p> <p><code>Warn</code>级别的日志会写入<code>/path/to/your/custom/log/warnLogName.log</code>文件</p> <p><code>Error</code>级别的日志会写入<code>/path/to/your/custom/log/errorLogName.log</code>文件</p> <h2 id="日志分类"><a href="#日志分类" class="header-anchor">#</a> 日志分类</h2> <p>框架内置了几种日志，分别在不同的场景下使用：</p> <ul><li><code>ContextLogger</code>：默认开启，使用<code>this.ctx.logger.info()</code>可使用，可获取上下文</li> <li><code>errorLogger</code>：任何logger的<code>.error()</code>调用输出的日志都会走此逻辑，默认关闭不使用，开启需要配置<code>dir errorLogName</code></li> <li><code>infoLogger</code>：任何logger的<code>.info()</code>调用输出的日志都会走此逻辑，默认关闭不使用，开启需要配置<code>dir infoLogName</code></li> <li><code>warnLogger</code>：任何logger的<code>.warn()</code>调用输出的日志都会走此逻辑，默认关闭不使用，开启需要配置<code>dir warnLogName</code></li></ul> <h2 id="如何打印日志"><a href="#如何打印日志" class="header-anchor">#</a> 如何打印日志</h2> <h3 id="contextlogger"><a href="#contextlogger" class="header-anchor">#</a> <code>ContextLogger</code></h3> <p>如果我们在处理请求时需要打印日志，这是需要使用<code>ContextLogger</code>，用于记录Web行为相关的日志，日志内容会携带当前请求的一些基本信息。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info1</span><span class="token punctuation">(</span><span class="token number">12312323</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;错误:&quot;</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>testService<span class="token punctuation">.</span><span class="token function">return1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// only output to stdout</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'warn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="日志级别"><a href="#日志级别" class="header-anchor">#</a> 日志级别</h2> <p>日志分为<code>ALL DEBUG INFO WARN ERROR NONE</code>6个级别。默认会同时打印<code>INFO</code>及以上级别的日志到文件和终端，可自定义日志输出级别：</p> <h3 id="_1-文件日志级别（默认info）"><a href="#_1-文件日志级别（默认info）" class="header-anchor">#</a> 1.文件日志级别（默认<code>INFO</code>）</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/logger.config.ts</span>
exports<span class="token punctuation">.</span>logger <span class="token operator">=</span> <span class="token punctuation">{</span>
   level<span class="token operator">:</span> <span class="token string">'ALL'</span> <span class="token comment">// 打印所有级别日志到文件中</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2-终端日志级别（默认info）"><a href="#_2-终端日志级别（默认info）" class="header-anchor">#</a> 2.终端日志级别（默认<code>INFO</code>）</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/logger.config.ts</span>
exports<span class="token punctuation">.</span>logger <span class="token operator">=</span> <span class="token punctuation">{</span>
   consoleLevel<span class="token operator">:</span> <span class="token string">'NONE'</span> <span class="token comment">//关闭日志终端输出</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>consoleLevel</code>优先级高于<code>level</code>，<code>consoleLevel</code>仅对终端输出生效。</p> <p><img src="/assets/img/consoleprint.e5526e4a.png" alt="images"></p> <h3 id="_3-生产环境关闭打印debug日志，默认关闭"><a href="#_3-生产环境关闭打印debug日志，默认关闭" class="header-anchor">#</a> 3.生产环境关闭打印debug日志，默认关闭</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/logger.config.ts</span>
exports<span class="token punctuation">.</span>logger <span class="token operator">=</span> <span class="token punctuation">{</span>
   allowDebugAtProd<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 是否打印debug日志</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="日志文件输出"><a href="#日志文件输出" class="header-anchor">#</a> 日志文件输出</h2> <ol><li>文件编码，默认编码为<code>utf-8</code>，可自定义</li> <li>日志文件输出格式默认为<code>[${meta.level} ${meta.pid}] ${meta.date} ${meta.hostname}: ${meta.message}</code></li></ol> <p><img src="/assets/img/fileprint.b6bbf36c.png" alt="images"></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/logger.config.ts</span>
exports<span class="token punctuation">.</span>logger <span class="token operator">=</span> <span class="token punctuation">{</span>
   encoding<span class="token operator">:</span> <span class="token string">'gbk'</span><span class="token punctuation">,</span>
   outputJSON<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="日志切割"><a href="#日志切割" class="header-anchor">#</a> 日志切割</h2> <ol><li>默认按天切割，在每日<code>00:00</code>按照.log.YYYY-MM-DD文件名切割。</li> <li>切割文件时间可配置，格式按照<code>node-schedule</code></li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// config/logger.config.ts</span>
exports<span class="token punctuation">.</span>logger <span class="token operator">=</span> <span class="token punctuation">{</span>
   splitTime<span class="token operator">:</span> <span class="token string">'00 00 * * * *'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>切割后日志文件如下所示：
<img src="/assets/img/loggers.6d95a2c6.png" alt="images"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/插件/i18n.html" class="prev">
        国际化（i18n）
      </a></span> <span class="next"><a href="/插件/Session.html">
        Session
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3d5ce5b5.js" defer></script><script src="/assets/js/2.9407ce33.js" defer></script><script src="/assets/js/4.e064d20e.js" defer></script>
  </body>
</html>
