"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[73],{7878:(s,n,a)=>{a.r(n),a.d(n,{default:()=>e});const l=(0,a(4386).uE)('<h1 id="定时任务-schedule" tabindex="-1"><a class="header-anchor" href="#定时任务-schedule" aria-hidden="true">#</a> 定时任务(schedule)</h1><p>例：我们在 app/schedule 目录下创建一个 pvSchedule.ts 文件</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#0d1117;"><code><span class="line"><span style="color:#FF7B72;">import</span><span style="color:#C9D1D9;"> {AbstractSchedule}  </span><span style="color:#FF7B72;">from</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;@umajs/plugin-schedule&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#FF7B72;">export</span><span style="color:#FFA657;"> </span><span style="color:#FF7B72;">default</span><span style="color:#FFA657;"> </span><span style="color:#FF7B72;">class</span><span style="color:#FFA657;"> PvSchedule </span><span style="color:#FF7B72;">extends</span><span style="color:#FFA657;"> </span><span style="color:#79C0FF;">AbstractSchedule</span><span style="color:#FFA657;"> {</span></span>\n<span class="line"><span style="color:#FFA657;">    </span><span style="color:#FF7B72;">constructor</span><span style="color:#FFA657;">(app)</span><span style="color:#C9D1D9;">{</span></span>\n<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#79C0FF;">super</span><span style="color:#C9D1D9;">(app)</span></span>\n<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#79C0FF;">this</span><span style="color:#C9D1D9;">.scheduleInfo </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> {</span></span>\n<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#8B949E;">// rule:&#39;0 0/1 * * * ?&#39;, // 每1分鐘更新一次</span></span>\n<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#8B949E;">// name:&#39;PV&#39;, // 定时任务名称</span></span>\n<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">// switch:true, // 开启定时任务</span></span>\n<span class="line"><span style="color:#C9D1D9;">        }</span></span>\n<span class="line"><span style="color:#C9D1D9;">    }</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#FFA657;">    </span><span style="color:#8B949E;">/**</span></span>\n<span class="line"><span style="color:#8B949E;">     * 业务实现</span></span>\n<span class="line"><span style="color:#8B949E;">     */</span></span>\n<span class="line"><span style="color:#FFA657;">    </span><span style="color:#FF7B72;">public</span><span style="color:#FFA657;"> </span><span style="color:#D2A8FF;">task</span><span style="color:#FFA657;">() </span><span style="color:#C9D1D9;">{</span></span>\n<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#8B949E;">// todo task</span></span>\n<span class="line"><span style="color:#C9D1D9;">    }</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#FFA657;">}</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="配置" tabindex="-1"><a class="header-anchor" href="#配置" aria-hidden="true">#</a> 配置</h3><p>1，在 config/plugin.config.ts 开启</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#0d1117;"><code><span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#A5D6FF;">&#39;schedule&#39;</span><span style="color:#C9D1D9;">: {</span></span>\n<span class="line"><span style="color:#C9D1D9;">        enable: </span><span style="color:#79C0FF;">true</span><span style="color:#C9D1D9;">,</span></span>\n<span class="line"><span style="color:#C9D1D9;">    }</span></span>\n<span class="line"></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>2，新建 schedule.config.ts，在其中填入配置项</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#0d1117;"><code><span class="line"><span style="color:#FF7B72;">export</span><span style="color:#FFA657;"> </span><span style="color:#FF7B72;">default</span><span style="color:#FFA657;"> [</span></span>\n<span class="line"><span style="color:#FFA657;">    {</span></span>\n<span class="line"><span style="color:#FFA657;">        </span><span style="color:#C9D1D9;">task: PvSchedule</span><span style="color:#FFA657;">, </span><span style="color:#8B949E;">// 定时任务类</span></span>\n<span class="line"><span style="color:#FFA657;">        </span><span style="color:#C9D1D9;">auto: </span><span style="color:#79C0FF;">true</span><span style="color:#FFA657;">, </span><span style="color:#8B949E;">// true 代表自动执行，false代表手动执行</span></span>\n<span class="line"><span style="color:#FFA657;">        </span><span style="color:#C9D1D9;">mark:</span><span style="color:#A5D6FF;">&quot;pv&quot;</span><span style="color:#C9D1D9;"> </span><span style="color:#8B949E;">// 任务标记</span></span>\n<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FFA657;">},</span></span>\n<span class="line"><span style="color:#FFA657;">    {</span></span>\n<span class="line"><span style="color:#FFA657;">        </span><span style="color:#FF7B72;">...</span></span>\n<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FFA657;">}]</span></span>\n<span class="line"></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>3，controller 初始化定时任务参数配置</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#0d1117;"><code><span class="line"><span style="color:#FF7B72;">export</span><span style="color:#FFA657;"> </span><span style="color:#FF7B72;">default</span><span style="color:#FFA657;"> </span><span style="color:#FF7B72;">class</span><span style="color:#FFA657;"> PvSchedule </span><span style="color:#FF7B72;">extends</span><span style="color:#FFA657;"> </span><span style="color:#79C0FF;">AbstractSchedule</span><span style="color:#FFA657;"> {</span></span>\n<span class="line"><span style="color:#FFA657;">    </span><span style="color:#FF7B72;">constructor</span><span style="color:#FFA657;">(app)</span><span style="color:#C9D1D9;">{</span></span>\n<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#79C0FF;">super</span><span style="color:#C9D1D9;">(app)</span></span>\n<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#79C0FF;">this</span><span style="color:#C9D1D9;">.scheduleInfo </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> {</span></span>\n<span class="line"><span style="color:#C9D1D9;">           rule:</span><span style="color:#A5D6FF;">&#39;0 0/1 * * * ?&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#8B949E;">// 每1分鐘更新一次</span></span>\n<span class="line"><span style="color:#C9D1D9;">           name:</span><span style="color:#A5D6FF;">&#39;PV&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#8B949E;">// 定时任务名称</span></span>\n<span class="line"><span style="color:#C9D1D9;">            switch:</span><span style="color:#79C0FF;">true</span><span style="color:#C9D1D9;">, </span><span style="color:#8B949E;">// true:开启定时任务; false:关闭定时任务</span></span>\n<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#FF7B72;">...</span><span style="color:#C9D1D9;">app</span></span>\n<span class="line"><span style="color:#C9D1D9;">        }</span></span>\n<span class="line"><span style="color:#C9D1D9;">    }</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#FFA657;">    </span><span style="color:#8B949E;">/**</span></span>\n<span class="line"><span style="color:#8B949E;">     * 业务实现</span></span>\n<span class="line"><span style="color:#8B949E;">     */</span></span>\n<span class="line"><span style="color:#FFA657;">    </span><span style="color:#FF7B72;">public</span><span style="color:#FFA657;"> </span><span style="color:#D2A8FF;">task</span><span style="color:#FFA657;">() </span><span style="color:#C9D1D9;">{</span></span>\n<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#8B949E;">// todo task</span></span>\n<span class="line"><span style="color:#C9D1D9;">    }</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#FFA657;">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="任务" tabindex="-1"><a class="header-anchor" href="#任务" aria-hidden="true">#</a> 任务</h3><ul><li>手动启动定时任务</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#0d1117;"><code><span class="line"><span style="color:#FF7B72;">import</span><span style="color:#C9D1D9;"> { umaTask } </span><span style="color:#FF7B72;">from</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;@umajs/plugin-schedule&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D2A8FF;">umaTask</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;pv&#39;</span><span style="color:#C9D1D9;">).</span><span style="color:#D2A8FF;">start</span><span style="color:#C9D1D9;">()</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>自动启动</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#0d1117;"><code><span class="line"><span style="color:#FFA657;">auto</span><span style="color:#C9D1D9;">: </span><span style="color:#79C0FF;">true</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>手动关闭定时任务</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#0d1117;"><code><span class="line"><span style="color:#D2A8FF;">umaTask</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;pv&#39;</span><span style="color:#C9D1D9;">).</span><span style="color:#D2A8FF;">cancel</span><span style="color:#C9D1D9;">()</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="定时方式" tabindex="-1"><a class="header-anchor" href="#定时方式" aria-hidden="true">#</a> 定时方式</h3><ul><li>Cron 风格定时器 （建议使用 Cron 风格,避免服务器时间不一致）</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#0d1117;"><code><span class="line"><span style="color:#FF7B72;">*</span><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">*</span><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">*</span><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">*</span><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">*</span><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">*</span></span>\n<span class="line"><span style="color:#C9D1D9;">┬ ┬ ┬ ┬ ┬ ┬</span></span>\n<span class="line"><span style="color:#C9D1D9;">│ │ │ │ │  </span><span style="color:#FF7B72;">|</span></span>\n<span class="line"><span style="color:#C9D1D9;">│ │ │ │ │ └ day </span><span style="color:#FF7B72;">of</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">week</span><span style="color:#C9D1D9;"> (</span><span style="color:#79C0FF;">0</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">-</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">7</span><span style="color:#C9D1D9;">) (</span><span style="color:#79C0FF;">0</span><span style="color:#C9D1D9;"> or </span><span style="color:#79C0FF;">7</span><span style="color:#C9D1D9;"> is Sun)</span></span>\n<span class="line"><span style="color:#C9D1D9;">│ │ │ │ └───── </span><span style="color:#D2A8FF;">month</span><span style="color:#C9D1D9;"> (</span><span style="color:#79C0FF;">1</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">-</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">12</span><span style="color:#C9D1D9;">)</span></span>\n<span class="line"><span style="color:#C9D1D9;">│ │ │ └────────── day </span><span style="color:#FF7B72;">of</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">month</span><span style="color:#C9D1D9;"> (</span><span style="color:#79C0FF;">1</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">-</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">31</span><span style="color:#C9D1D9;">)</span></span>\n<span class="line"><span style="color:#C9D1D9;">│ │ └─────────────── </span><span style="color:#D2A8FF;">hour</span><span style="color:#C9D1D9;"> (</span><span style="color:#79C0FF;">0</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">-</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">23</span><span style="color:#C9D1D9;">)</span></span>\n<span class="line"><span style="color:#C9D1D9;">│ └──────────────────── </span><span style="color:#D2A8FF;">minute</span><span style="color:#C9D1D9;"> (</span><span style="color:#79C0FF;">0</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">-</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">59</span><span style="color:#C9D1D9;">)</span></span>\n<span class="line"><span style="color:#C9D1D9;">└───────────────────────── </span><span style="color:#D2A8FF;">second</span><span style="color:#C9D1D9;"> (</span><span style="color:#79C0FF;">0</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">-</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">59</span><span style="color:#C9D1D9;">, </span><span style="color:#79C0FF;">OPTIONAL</span><span style="color:#C9D1D9;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C9D1D9;">6个占位符从左到右分别代表：秒、分、时、日、月、周几</span></span>\n<span class="line"></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>interval 风格定时器，更多配置参考 node-schedule</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#0d1117;"><code><span class="line"><span style="color:#FF7B72;">import</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">*</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">as</span><span style="color:#C9D1D9;"> schedule </span><span style="color:#FF7B72;">from</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;node-schedule&#39;</span><span style="color:#C9D1D9;">;</span></span>\n<span class="line"><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> rule </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">new</span><span style="color:#C9D1D9;"> schedule.</span><span style="color:#D2A8FF;">RecurrenceRule</span><span style="color:#C9D1D9;">();</span></span>\n<span class="line"><span style="color:#C9D1D9;">rule.second </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;">[</span><span style="color:#79C0FF;">0</span><span style="color:#C9D1D9;">,</span><span style="color:#79C0FF;">1</span><span style="color:#C9D1D9;">,</span><span style="color:#79C0FF;">2</span><span style="color:#C9D1D9;">,</span><span style="color:#79C0FF;">3.</span><span style="color:#FF7B72;">...</span><span style="color:#C9D1D9;">.</span><span style="color:#79C0FF;">.59</span><span style="color:#C9D1D9;">] 每秒执行</span></span>\n<span class="line"><span style="color:#C9D1D9;">rule.second </span><span style="color:#FF7B72;">=</span><span style="color:#79C0FF;">0</span><span style="color:#C9D1D9;"> 每分钟0秒执行</span></span>\n<span class="line"><span style="color:#C9D1D9;">rule.minute </span><span style="color:#FF7B72;">=</span><span style="color:#79C0FF;">0</span><span style="color:#C9D1D9;"> 每小时30分执行</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#79C0FF;">this</span><span style="color:#C9D1D9;">.scheduleInfo </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> {</span></span>\n<span class="line"><span style="color:#C9D1D9;">    rule, </span><span style="color:#8B949E;">// 每1分鐘更新一次</span></span>\n<span class="line"><span style="color:#C9D1D9;">}</span></span>\n<span class="line"></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="集群-分布式部署-执行定时任务" tabindex="-1"><a class="header-anchor" href="#集群-分布式部署-执行定时任务" aria-hidden="true">#</a> 集群/分布式部署 执行定时任务</h3><ul><li>插件包含在分布式部署下，需要保证同一个定时任务只能运行一次，所以需要用事物锁来控制;</li><li>插件采用的是分布式事务锁方案，支持单台 redis 和多台 redis 方案，基于 redis 实现</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#0d1117;"><code><span class="line"><span style="color:#FF7B72;">import</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">*</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">as</span><span style="color:#C9D1D9;"> RedLock  </span><span style="color:#FF7B72;">from</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;redlock&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#FF7B72;">var</span><span style="color:#C9D1D9;"> client1 </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">require</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;redis&#39;</span><span style="color:#C9D1D9;">).</span><span style="color:#D2A8FF;">createClient</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">6379</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;redis1.example.com&#39;</span><span style="color:#C9D1D9;">);</span></span>\n<span class="line"><span style="color:#FF7B72;">var</span><span style="color:#C9D1D9;"> client2 </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">require</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;redis&#39;</span><span style="color:#C9D1D9;">).</span><span style="color:#D2A8FF;">createClient</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">6379</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;redis2.example.com&#39;</span><span style="color:#C9D1D9;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#79C0FF;">this</span><span style="color:#C9D1D9;">.scheduleInfo</span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> {</span></span>\n<span class="line"><span style="color:#C9D1D9;">            rule: </span><span style="color:#A5D6FF;">&#39;0 0/1 * * * ?&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#8B949E;">// 每1分鐘更新一次</span></span>\n<span class="line"><span style="color:#C9D1D9;">            name: </span><span style="color:#A5D6FF;">&#39;pv&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#8B949E;">// 任务名称</span></span>\n<span class="line"><span style="color:#C9D1D9;">            switch: </span><span style="color:#79C0FF;">true</span><span style="color:#C9D1D9;">, </span><span style="color:#8B949E;">// 定时任务开启</span></span>\n<span class="line"><span style="color:#C9D1D9;">            redLock:</span><span style="color:#FF7B72;">new</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">RedLock</span><span style="color:#C9D1D9;">([client1,client2]), </span><span style="color:#8B949E;">// 采用redis锁</span></span>\n<span class="line"><span style="color:#C9D1D9;">            redLockTKL:</span><span style="color:#79C0FF;">10000</span><span style="color:#C9D1D9;"> ,</span><span style="color:#8B949E;">//单位毫秒，锁的生存时间，在该时间内，若锁未释放，强行释放 避免死锁情况</span></span>\n<span class="line"><span style="color:#C9D1D9;">            sleep:</span><span style="color:#79C0FF;">1000</span><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">//单位毫秒，执行任务后主动释放锁的时间</span></span>\n<span class="line"><span style="color:#C9D1D9;">    },</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div>',25),p={},e=(0,a(4110).Z)(p,[["render",function(s,n){return l}]])},4857:(s,n,a)=>{a.r(n),a.d(n,{data:()=>l});const l={key:"v-1d268e5a",path:"/%E6%8F%92%E4%BB%B6/schedule.html",title:"定时任务(schedule)",lang:"zh-CN",frontmatter:{head:[["meta",{property:"og:url",content:"/v1/%E6%8F%92%E4%BB%B6/schedule.html"}],["meta",{property:"og:site_name",content:"UMajs"}],["meta",{property:"og:title",content:"定时任务(schedule)"}],["meta",{property:"og:type",content:"article"}],["meta",{property:"og:locale",content:"zh-CN"}],["meta",{property:"og:locale:alternate",content:"en-US"}],["meta",{name:"twitter:card",content:"summary_large_image"}],["meta",{name:"twitter:image:alt",content:"UMajs"}],["meta",{property:"article:author",content:"JiaZeng"}],["meta",{property:"og:restrictions:age",content:"3+"}],["meta",{name:"twitter:creator",content:"UMajs"}]]},excerpt:"",headers:[{level:3,title:"配置",slug:"配置",children:[]},{level:3,title:"任务",slug:"任务",children:[]},{level:3,title:"定时方式",slug:"定时方式",children:[]},{level:3,title:"集群/分布式部署 执行定时任务",slug:"集群-分布式部署-执行定时任务",children:[]}],filePathRelative:"插件/schedule.md",git:{updatedTime:1630481998e3,contributors:[{name:"jiazengp",email:"jiazengp@gmail.com",commits:1}]}}},4110:(s,n)=>{n.Z=(s,n)=>{for(const[a,l]of n)s[a]=l;return s}}}]);