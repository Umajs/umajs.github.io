(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{367:function(t,a,s){"use strict";s.r(a);var e=s(43),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"控制器（controller）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#控制器（controller）"}},[t._v("#")]),t._v(" 控制器（Controller）")]),t._v(" "),s("h2",{attrs:{id:"什么是控制器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是控制器"}},[t._v("#")]),t._v(" 什么是控制器")]),t._v(" "),s("p",[t._v("控制器负责解析用户输入，并向用户返回处理结果。")]),t._v(" "),s("p",[t._v("在控制器中，我们可以指定什么时候（"),s("strong",[t._v("路由")]),t._v("）去响应，怎么样（"),s("strong",[t._v("服务")]),t._v("）去返回结果。")]),t._v(" "),s("h2",{attrs:{id:"控制器加载与编写"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#控制器加载与编写"}},[t._v("#")]),t._v(" 控制器加载与编写")]),t._v(" "),s("h3",{attrs:{id:"加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#加载"}},[t._v("#")]),t._v(" 加载")]),t._v(" "),s("p",[t._v("控制器也是通过约定的策略进行加载：默认加载"),s("code",[t._v("${URSA_ROOT}/controller")]),t._v("下所有"),s("code",[t._v("*.controller")]),t._v("文件。")]),t._v(" "),s("h3",{attrs:{id:"控制器编写"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#控制器编写"}},[t._v("#")]),t._v(" 控制器编写")]),t._v(" "),s("p",[s("code",[t._v("Uma")]),t._v("的控制器需要通过类的继承的方式实现，方法必须都返回框架内置的 Result 静态方法，如下代码")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" BaseController "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@umajs/core'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Index")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BaseController")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 等同于 return Result.send('this is index router');")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'this is index router'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[t._v("命中路由规则的控制器，在请求时会被实例化，以下属性可以通过"),s("code",[t._v("this")]),t._v("获取：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("ctx")]),t._v(":  当前请求上下文")]),t._v(" "),s("li",[s("code",[t._v("req")]),t._v(": "),s("code",[t._v("Request")]),t._v("实例")]),t._v(" "),s("li",[s("code",[t._v("res")]),t._v(": "),s("code",[t._v("Response")]),t._v("实例")])]),t._v(" "),s("h2",{attrs:{id:"获取请求参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取请求参数"}},[t._v("#")]),t._v(" 获取请求参数")]),t._v(" "),s("h3",{attrs:{id:"query和路由参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#query和路由参数"}},[t._v("#")]),t._v(" query和路由参数")]),t._v(" "),s("p",[t._v("详见Router#@Param、@Query修饰器")]),t._v(" "),s("h3",{attrs:{id:"header"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#header"}},[t._v("#")]),t._v(" header")]),t._v(" "),s("p",[t._v("获取header参数可以用"),s("code",[t._v("this.header(name)")]),t._v("方法获取。")]),t._v(" "),s("h3",{attrs:{id:"cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[t._v("#")]),t._v(" cookie")]),t._v(" "),s("p",[t._v("在控制器中，可以通过"),s("code",[t._v("this.ctx.cookies.get")]),t._v("方法获取cookie。")]),t._v(" "),s("h3",{attrs:{id:"session"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[t._v("#")]),t._v(" session")]),t._v(" "),s("p",[t._v("默认情况下，"),s("code",[t._v("Uma")]),t._v("的Session插件通过cookie存储session，详细的配置和用法可以通过Plugin#Session获取。")]),t._v(" "),s("p",[t._v("在控制器中，可以通过"),s("code",[t._v("this.ctx.session")]),t._v("对象获取相应的session值。")]),t._v(" "),s("h3",{attrs:{id:"body和上传文件的获取"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#body和上传文件的获取"}},[t._v("#")]),t._v(" body和上传文件的获取")]),t._v(" "),s("h2",{attrs:{id:"发送响应"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发送响应"}},[t._v("#")]),t._v(" 发送响应")]),t._v(" "),s("p",[t._v("返回的数据都可以通过"),s("code",[t._v("Result")]),t._v("来返回。 "),s("code",[t._v("BaseController")]),t._v("也内置了"),s("code",[t._v("Result")]),t._v("一样的方法，还内置了一些方便使用的方法。")]),t._v(" "),s("h3",{attrs:{id:"set-status-status-number"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#set-status-status-number"}},[t._v("#")]),t._v(" set status(status: number);")]),t._v(" "),s("p",[t._v("正确的设置http的状态码，可以增强请求的语义性。可以通过"),s("code",[t._v("this.status = code")]),t._v("设置返回的状态码。")]),t._v(" "),s("h3",{attrs:{id:"get-useragent-any"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#get-useragent-any"}},[t._v("#")]),t._v(" get userAgent(): any;")]),t._v(" "),s("p",[t._v("获取请求的 user-agent")]),t._v(" "),s("h3",{attrs:{id:"get-param-any"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#get-param-any"}},[t._v("#")]),t._v(" get param(): any;")]),t._v(" "),s("p",[t._v("获取请求的参数")]),t._v(" "),s("h3",{attrs:{id:"setheader-name-string-any-value-string-string-void"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setheader-name-string-any-value-string-string-void"}},[t._v("#")]),t._v(" setHeader(name: string | any, value: string | string[]): void;")]),t._v(" "),s("p",[t._v("设置请求 header")]),t._v(" "),s("h3",{attrs:{id:"getheader-name-string-any-any"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#getheader-name-string-any-any"}},[t._v("#")]),t._v(" getHeader(name: string | any): any;")]),t._v(" "),s("p",[t._v("获取请求 header")]),t._v(" "),s("h3",{attrs:{id:"统一返回-result"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#统一返回-result"}},[t._v("#")]),t._v(" 统一返回 Result")]),t._v(" "),s("p",[t._v("在 controller 中可以 "),s("code",[t._v("return Result[...](...)")]),t._v("，也可以 "),s("code",[t._v("return this[...](...)")]),t._v("，更多介绍见"),s("RouterLink",{attrs:{to:"/基础功能/Result.html"}},[t._v("Result")]),t._v("。")],1),t._v(" "),s("h4",{attrs:{id:"this-send-val-status"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#this-send-val-status"}},[t._v("#")]),t._v(" "),s("code",[t._v("this.send(val, status)")])]),t._v(" "),s("p",[t._v("用于快捷返回文本内容，第二个参数为返回状态码。")]),t._v(" "),s("h4",{attrs:{id:"this-json-data"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#this-json-data"}},[t._v("#")]),t._v(" "),s("code",[t._v("this.json(data)")])]),t._v(" "),s("p",[t._v("返回json数据，并将"),s("code",[t._v("content-type")]),t._v("设置为"),s("code",[t._v("application/json")]),t._v("。")]),t._v(" "),s("h4",{attrs:{id:"this-jsonp-data-callback"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#this-jsonp-data-callback"}},[t._v("#")]),t._v(" "),s("code",[t._v("this.jsonp(data, callback)")])]),t._v(" "),s("p",[t._v("以jsonp的形式返回数据。")]),t._v(" "),s("h4",{attrs:{id:"this-view-templatepath-data"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#this-view-templatepath-data"}},[t._v("#")]),t._v(" "),s("code",[t._v("this.view(templatePath, data)")])]),t._v(" "),s("p",[t._v("通过渲染模板的方式将数据返回。")]),t._v(" "),s("h4",{attrs:{id:"this-stream-data-filename"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#this-stream-data-filename"}},[t._v("#")]),t._v(" "),s("code",[t._v("this.stream(data, fileName)")])]),t._v(" "),s("p",[t._v("将文件以流（stream）的方式返回")]),t._v(" "),s("h4",{attrs:{id:"this-download-filepath-opts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#this-download-filepath-opts"}},[t._v("#")]),t._v(" "),s("code",[t._v("this.download(filePath, opts)")])]),t._v(" "),s("p",[t._v("下载文件")]),t._v(" "),s("h4",{attrs:{id:"this-done"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#this-done"}},[t._v("#")]),t._v(" "),s("code",[t._v("this.done()")])]),t._v(" "),s("p",[t._v("使用 ctx 进行完了操作，不需要使用 Result 进行其它的返回时使用此方法，常用于框架的迁移。")])])}),[],!1,null,null,null);a.default=r.exports}}]);